<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>成績編集</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='base-style.css') }}">
</head>
<body>
    <h1>成績を編集</h1>
    <ul class="breadcrumb">
        <li><a href="{{ url_for('index') }}">HOME</a></li>
        <li><a href="{{ url_for('order.list') }}">成績一覧</a></li>
        <li>成績を編集</li>
    </ul>

    <form action="{{ url_for('order.edit', order_id=order.id) }}" method="post">
        <div>
            <label for="user_id">生徒:</label>
            <select id="user_id" name="user_id" required>
                {% for user in users %}
                    <option value="{{ user.id }}" {% if order.user.id == user.id %}selected{% endif %}>
                {{ user.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="product_id">科目:</label>
            <select id="product_id" name="product_id" required>
                {% for product in products %}
                    <option value="{{ product.id }}" {% if order.product.id == product.id %}selected{% endif %}>
                {{ product.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="type">種類:</label>
            <select id="type" name="type" required>
                {% set types = ['１学期中間','１学期期末','２学期中間','２学期期末','学年末'] %}
                {% for t in types %}
            <option value="{{ t }}" {% if order.type == t %}selected{% endif %}>{{ t }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="test_result">テスト結果（0〜100）:</label>
            <input type="number"
                id="test_result" name="test_result"
                min="0" max="100" step="1"
                required inputmode="numeric" pattern="\d+"
                value="{{ order.test_result }}">
        <script>
            document.getElementById('test_result').addEventListener('input', function(e) {
                const v = e.target.value;
                    if (v !== '' && (Number(v) < 0 || Number(v) > 100)) {
                      e.target.setCustomValidity('0〜100の範囲で入力してください');
                    } else {
                      e.target.setCustomValidity('');
                    }
            });
        </script>
    </div>
    <button type="submit">保存</button>
    </form>
</body>
</html>
